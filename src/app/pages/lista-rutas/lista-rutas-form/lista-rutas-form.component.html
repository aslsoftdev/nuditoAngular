<div class="container-fluid mt-3" *ngIf="ruta">

  <!-- Resumen en tarjetas KPI -->
  <div class="row g-3 mb-4 text-center">
    <div class="col-md-3">
      <div class="card shadow-sm border-0 p-4 bg-primary text-white rounded-3">
        <i class="ti ti-user fs-1 mb-2"></i>
        <h6 class="mb-1">Vendedor</h6>
        <h4 class="fw-bold">{{ ruta.nombre_usuario }}</h4>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm border-0 p-4 bg-warning text-dark rounded-3">
        <i class="ti ti-clock fs-1 mb-2"></i>
        <h6 class="mb-1">Duración</h6>
        <h4 class="fw-bold">{{ ruta.duracion }}</h4>
      </div>
    </div>

    <!-- Clientes Visitados -->
    <div class="col-md-3">
      <div class="card shadow-sm border-0 p-4 bg-success text-white rounded-3">
        <i class="ti ti-users fs-1 mb-2"></i>
        <h6 class="mb-1">Clientes Visitados</h6>
        <h4 class="fw-bold">0/0</h4>
      </div>
    </div>

    <!-- Clientes Cerrados -->
    <div class="col-md-3">
      <div class="card shadow-sm border-0 p-4 bg-danger text-white rounded-3">
        <i class="ti ti-door-exit fs-1 mb-2"></i>
        <h6 class="mb-1">Clientes Cerrados</h6>
        <h4 class="fw-bold">0</h4>
      </div>
    </div>
  </div>

  <!-- INFO RUTA -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <h5 class="fw-bold mb-3">
        <i class="ti ti-road me-2 text-primary"></i> Información de la Ruta
      </h5>
      <p><strong>Folio:</strong> {{ ruta.id_ruta }}</p>
      <p>
        <strong>Estado:</strong>
        <span class="badge"
              [ngClass]="{
                'bg-warning text-dark': ruta.estado_actual === 'En Proceso',
                'bg-success': ruta.estado_actual === 'Terminada',
                'bg-danger': ruta.estado_actual === 'Cerrada'
              }">
          {{ ruta.estado_actual }}
        </span>
      </p>
      <p *ngIf="ruta.fecha_inicio"><strong>Fecha inicio:</strong> {{ ruta.fecha_inicio | date:'short' }}</p>
      <p *ngIf="ruta.fecha_fin"><strong>Fecha fin:</strong> {{ ruta.fecha_fin | date:'short' }}</p>
      <p *ngIf="ruta.fecha_cerrada"><strong>Fecha cerrada:</strong> {{ ruta.fecha_cerrada | date:'short' }}</p>
    </div>
  </div>

  <!-- DINERO -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <h5 class="fw-bold mb-3">
        <i class="ti ti-cash me-2 text-success"></i> Dinero
      </h5>
      <ul class="list-unstyled">
        <li><strong>Total Efvo. Calculado:</strong> ${{ ruta.total_efectivo! + ruta.total_pagos_creditos_efectivo! }}</li>
        <li><strong>Total Trans. Calculadas:</strong> ${{ ruta.total_transferencias! + ruta.total_pagos_creditos_transferencias! }}</li>
        <li><strong>Total Crédito:</strong> ${{ ruta.total_credito }}</li>
        <li><strong>Total Efectivo:</strong> ${{ ruta.dineroEntregado!.totalEfectivo }}</li>
        <li><strong>Total Transferencias:</strong> ${{ ruta.dineroEntregado!.totalTransferencias }}</li>
        <li><strong>Total Ruta:</strong> ${{ ruta.total_credito! + ruta.total_efectivo! + ruta.total_transferencias! + ruta.total_tarjeta! + ruta.total_pagos_creditos_efectivo }}</li>
        <li *ngIf="ruta.estado_actual === 'Cerrada'">
          <strong>Faltante:</strong> ${{ ruta.dineroEntregado!.totalFaltante }}
        </li>
        <li>
          <strong>A entregar:</strong> ${{ ruta.total_efectivo! + ruta.total_pagos_creditos_efectivo + faltanteSobrante! }}
        </li>
      </ul>
    </div>
  </div>

  <!-- EXISTENCIAS -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <h5 class="fw-bold mb-3">
        <i class="ti ti-package me-2 text-secondary"></i>Existencias
      </h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Producto</th>
              <th>Inicial</th>
              <th>Ventas</th>
              <th>Devoluciones</th>
              <th>Final</th>
              <th>Real</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let d of ruta.detalles">
              <td class="fw-semibold">{{ d.nombre_producto }}</td>
              <td>{{ d.existencia_inicial }}</td>
              <td class="text-danger fw-bold">{{ d.ventas }}</td>
              <td>{{ d.devoluciones }}</td>
              <td>{{ d.existencia_real }}</td>
              <td>{{ d.existencia_real }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- VISITAS -->
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <h5 class="fw-bold mb-3">
        <i class="ti ti-users me-2 text-secondary"></i>Visitas
      </h5>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Cliente</th>
              <th>Clasificación</th>
              <th>Fecha</th>
              <th>Venta</th>
              <th>Método</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let v of ruta.visitas">
              <td>{{ v.cliente }}</td>
              <td class="fw-semibold">{{ v.nombre_cliente }}</td>
              <td>
                <span class="badge bg-success">{{ v.nombre_clasificacion }}</span>
              </td>
              <td>{{ v.fecha_registro | date:'short' }}</td>
              <td class="fw-bold text-primary">${{ v.ventas[0]?.total }}</td>
              <td>
                <span class="badge bg-info text-dark">{{ v.ventas[0]?.pagos[0]?.metodo_pago }}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
